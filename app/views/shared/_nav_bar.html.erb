<header>
  <nav class="navbar navbar-light navbar-white fixed-top navbar-expand-lg" role="navigation">
    <a class="navbar-brand" href="<%= cycle_time_deployment_constraint_path %>">
      <%= image_tag('320px-Jumbo_Logo.png', height: '32', class:'mr-3') %>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle <%= 'text-yellow' if controller_name == 'department_report' || controller_name == 'kpi_goals' %>" href="#" id="navbarDropdownMenuLink4" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Department
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink4">
            <!--<li><a class="dropdown-item <%= 'text-yellow' if action_name == 'index' %>" href="<%= cycle_time_deployment_constraint_path(deployment_constraint_id: 1) %>">
              Dashboard
            </a></li>-->
            <li class="dropdown-submenu">
              <a class="dropdown-item dropdown-toggle <%= 'text-yellow' if controller_name == 'kpi_goals' %>" href="#">KPI goals</a>
              <ul class="dropdown-menu">
                <% @departments.each do |department| %>
                <li><a class="dropdown-item <%= 'text-yellow' if controller_name == 'kpi_goals' && @department.id == department.id %>" href="<%= kpi_goals_path(department_id: department.id) %>">
                  <%= department.name %>
                </a></li>
                <% end %>
              </ul>
            </li>
            <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'deployments_overview' %>" href="<%= department_deployments_overview_path %>">
              Deployments
            </a></li>
            <li class="dropdown-submenu">
              <a class="dropdown-item dropdown-toggle <%= 'text-yellow' if action_name == 'cycle_time_overview' %>" href="#">Cycle time overview</a>
              <ul class="dropdown-menu">
                <% @departments.each do |department| %>
                <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'cycle_time_overview' && @department.id == department.id %>" href="<%= department_cycle_time_overview_path(department_id: department.id) %>">
                  <%= department.name %>
                </a></li>
                <% end %>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a class="dropdown-item dropdown-toggle <%= 'text-yellow' if action_name == 'issues_overview' %>" href="#">Overview of tickets released</a>
              <ul class="dropdown-menu">
                <% @departments.each do |department| %>
                <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'issues_overview' && @department.id == department.id %>" href="<%= department_issues_overview_path(department_id: department.id) %>">
                  <%= department.name %>
                </a></li>
                <% end %>
              </ul>
            </li>
          </ul>
        </li>



        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle <%= 'text-yellow' if controller_name == 'cycle_time_report' %>" href="#" id="navbarDropdownMenuLink1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Cycle time
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink1">
            <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'deployment_constraint' %>" href="<%= cycle_time_deployment_constraint_path(deployment_constraint_id: 1) %>">
              Constraint groups
            </a></li>
            <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'team' %>" href="<%= cycle_time_team_path(board_id: @teams.first.board_id) %>">
              Teams
            </a></li>
            <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'two_week_overview' %>" href="<%= cycle_time_two_week_overview_path(deployment_constraint_id: 1) %>">
              2-week overview
            </a></li>
            <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'four_week_overview' %>" href="<%= cycle_time_four_week_overview_path(deployment_constraint_id: 1) %>">
              4-week overview
            </a></li>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle <%= 'text-yellow' if controller_name == 'portfolio_report' %>" href="#" id="navbarDropdownMenuLink3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Portfolio
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink3">
            <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'epics_overview' %>" href="<%= portfolio_epics_path %>">
              Epics
            </a></li>
            <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'quarter_overview' %>" href="<%= portfolio_quarter_path %>">
              Quarter
            </a></li>
            <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'export' %>" href="<%= portfolio_export_path %>">
              Export
            </a></li>
            <li class="dropdown-submenu">
                <a class="dropdown-item dropdown-toggle <%= 'text-yellow' if action_name == 'teams_overview' %>" href="#">Teams</a>
                <ul class="dropdown-menu">
                  <% @departments.each do |department| %>
                  <li><a class="dropdown-item <%= 'text-yellow' if action_name == 'teams_overview' && @department == department %>" href="<%= portfolio_teams_path(department_id: department.id) %>">
                    <%= department.name %>
                  </a></li>
                  <% end %>
                </ul>
            </li>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle <%= 'text-yellow' if controller_name == 'sprint_report' %>" href="#" id="navbarDropdownMenuLink2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Sprints
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink2">
            <% @departments.each do |department| %>
            <li class="dropdown-submenu">
              <a class="dropdown-item dropdown-toggle <%= 'text-yellow' if controller_name == 'sprint_report' && @board.team.department == department %>" href="#"><%= department.name %></a>
              <ul class="dropdown-menu">
                <% department.active_teams.each do |team| %>
                  <li><a class="dropdown-item <%= 'text-yellow' if @board && team.name == @board.team.name && controller_name == 'sprint_report' %>" href="<%= sprint_report_path(board_id: team.board_id)%>"><%= team.name %></a></li>
                <% end %>
              </ul>
            </li>
            <% end %>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link <%= 'text-yellow' if controller_name == 'deployment_report' %>" href="<%= deployment_report_path %>">
            Deployments
          </a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link <%= 'text-yellow' if controller_name == 'p1_report' %>" href="<%= p1_report_path %>">
            P1 Overview
          </a>
        </li>
      </ul>
      <%= link_to 'Refresh data', sprint_report_refresh_path(board_id: @board.id), method: :post, class: 'btn btn-secondary', data: { disable_with: "In progress..." } if @board %>
    </div>
  </nav>
</header>
<% if @updating_cache_since %>
<div class="alert alert-warning" role="alert">
  The application is updating it's data from JIRA at the moment. Data can be inconsistent or incorrect until the update has finished.
  Update expected to finish around <%= (@updating_cache_since + 90.minutes).strftime('%H:%M') %>
</div>
<% end %>
<script>
  $().ready(function() {
    $('.dropdown-submenu').hover(function(e) {
      $(this).find('ul.dropdown-menu').show();
    }, function(e){
      $(this).find('ul.dropdown-menu').hide();
    });
  })
</script>
