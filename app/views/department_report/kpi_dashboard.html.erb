<div class="main">
  <div class="row pl-3">
    <ul class="nav">
      <% @quarters.each do |quarter| %>
      <li class="nav-item">
        <a class="btn btn-outline-jumbo btn-sm shadow-sm mb-4 mr-2 <%= 'active' if quarter == @current_quarter %>"
          href="<%= department_kpi_dashboard_path(quarter_id: quarter.id) %>">
          <%= quarter.name %>
        </a>
      </li>
     <% end %>
    </ul>
  </div>
  <div class="card box-shadow mb-4">
    <div class="card-header">
      <a href="<%= department_kpi_dashboard_path(quarter: @current_quarter, format: 'csv') %>"
        class="card-link float-right">
        Download as csv file
      </a>
      <strong>Today's <%= @department.name %> KPI goals overview for quarter <%= @current_quarter.name %></strong><br>
      <small class="text-muted small"></small>
    </div>
    <div class="card-body">
      <table class="table table-bordered">
          <thead>
            <tr class="small">
              <% @report[:table][0][0..-2].each do |header_item| %>
              <th><div><%= header_item %></div></th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% @report[:table][1..-1].each do |row| %>
            <tr class="small">
             <% row[0..-2].each_with_index do |row_item, index| %>
             <td class="<%= 'text-center' unless index == 0 %> <%= "bg-#{row[-1]}" if row_item == row[-2] %>"">
             <%= row_item %>
             </td>
             <% end %>
           </tr>
           <% end %>
          </tbody>
      </table>
    </div>
  </div>
    <%= render partial: 'percentage_kpi_chart', locals: { report: @report, options: { type: :cycle_time, title: 'Cycle time', subtitle: 'Cycle time calculated in two week periods' } } %>
    <%= render partial: 'cumulative_kpi_chart', locals: { report: @report, options: { type: :deployments, title: 'Deployments (cumulative)' } } %>
    <%= render partial: 'cumulative_kpi_chart', locals: { report: @report, options: { type: :issues, title: 'Released issues (cumulative)', subtitle: 'Number of JIRA tickets moved to \'Released\' status' } } %>
    <%= render partial: 'cumulative_kpi_chart', locals: { report: @report, options: { type: :p1s, title: 'P1 incidents (cumulative)' } } %>
    <%= render partial: 'percentage_kpi_chart', locals: { report: @report, options: { type: :time_to_recover, title: 'Time to recover', subtitle: 'Average time (in minutes) to recover for P1 incidents' } } %>
    <%= render partial: 'percentage_kpi_chart', locals: { report: @report, options: { type: :uptime, title: 'Uptime', subtitle: 'Uptime calculated excluding maintenance window', min_y: 85 } } %>
</div>
